<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è‹±æ–‡ 1â€“10 æ‹¼éŸ³å­¸ç¿’</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+TC:wght@400;700&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet" />
  <!-- æ–°å¢ Font Awesome é€£çµä»¥é¡¯ç¤ºç¤¾äº¤åª’é«”åœ–æ¨™ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    :root{
      --c-cvc-bg:#d1fae5; --c-cvc-border:#10b981; --c-cvc-text:#065f46;
      --c-magic-e-bg:#dbeafe; --c-magic-e-border:#3b82f6; --c-magic-e-text:#1e40af;
      --c-vowel-team-bg:#ffedd5; --c-vowel-team-border:#f97316; --c-vowel-team-text:#9a3412;
      --c-r-controlled-bg:#e9d5ff; --c-r-controlled-border:#a855f7; --c-r-controlled-text:#581c87;
      --c-heart-word-bg:#fee2e2; --c-heart-word-border:#ef4444; --c-heart-word-text:#991b1b;
      --c-cvc-schwa-bg:#ccfbf1; --c-cvc-schwa-border:#14b8a6; --c-cvc-schwa-text:#0f766e;
    }
    *{box-sizing:border-box;}
    body{font-family:'Inter','Noto Sans TC',sans-serif;background:#f8fafc;color:#1e293b;margin:0;padding:1rem;line-height:1.6;font-size:18px;}
    .container{max-width:1200px;margin:0 auto;padding:1rem;background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.05);}

    h1{font-family:'Noto Sans TC',sans-serif;font-size:2rem;font-weight:700;color:#0f172a;text-align:center;margin-bottom:2rem;}

    /* Legend */
    .legend{display:flex;flex-wrap:wrap;gap:.75rem;justify-content:center;margin-bottom:2rem;padding:0;list-style:none;}
    .legend-item,.category-tag{padding:.3rem .75rem;border-radius:999px;font-size:.9rem;font-weight:700;border:2px solid;white-space:nowrap;cursor:pointer;user-select:none;transition:transform .1s ease,opacity .2s ease;}
    .legend-item:hover{transform:scale(1.05);}
    .legend-item.selected{outline:3px solid rgba(14,165,233,.25);}
    .tag-all{background:#e5e7eb;border-color:#94a3b8;color:#334155;}

    /* ä¸­æ–‡åˆ†é¡æŒ‰éˆ•è‰²ç³» */
    .tag-irregular{background:var(--c-heart-word-bg);border-color:var(--c-heart-word-border);color:var(--c-heart-word-text);}
    .tag-closed{background:var(--c-cvc-bg);border-color:var(--c-cvc-border);color:var(--c-cvc-text);}
    .tag-floss{background:#ffe4e6;border-color:#fb7185;color:#9f1239;}
    .tag-digraph{background:#e0f2fe;border-color:#38bdf8;color:#075985;}
    .tag-cluster{background:#ede9fe;border-color:#8b5cf6;color:#4c1d95;}
    .tag-suffix{background:#fef9c3;border-color:#f59e0b;color:#78350f;}
    .tag-rcontrolled{background:var(--c-r-controlled-bg);border-color:var(--c-r-controlled-border);color:var(--c-r-controlled-text);}
    .tag-open{background:#dcfce7;border-color:#22c55e;color:#14532d;}
    .tag-cle{background:#f5f5f4;border-color:#a8a29e;color:#3f3f46;}
    .tag-magic-e-cn{background:var(--c-magic-e-bg);border-color:var(--c-magic-e-border);color:var(--c-magic-e-text);}
    .tag-vowel-team-cn{background:var(--c-vowel-team-bg);border-color:var(--c-vowel-team-border);color:var(--c-vowel-team-text);}
    .tag-diphthong{background:#dbeafe;border-color:#60a5fa;color:#1e3a8a;}
    .tag-silent-con{background:#f1f5f9;border-color:#94a3b8;color:#334155;}

    /* å¡ç‰‡ */
    #teaching-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1.5rem;}
    .word-card{border:2px solid #cbd5e1;border-radius:12px;background:#fff;box-shadow:0 4px 6px rgba(0,0,0,.03);overflow:hidden;transition:transform .2s,box-shadow .2s;}
    .word-card.hidden{display:none;}
    .word-card:hover{transform:translateY(-5px);box-shadow:0 8px 15px rgba(0,0,0,.07);}

    .card-header{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;background:#f1f5f9;border-bottom:2px solid #e2e8f0;}
    .card-title{display:flex;align-items:baseline;gap:.75rem;}
    .word-number{font-size:1.5rem;font-weight:700;color:#64748b;}
    .word-text{font-size:2.5rem;font-weight:700;color:#0f172a;}
    .audio-button{font-size:2rem;cursor:pointer;background:none;border:none;padding:0;line-height:1;}

    .card-body{padding:1.5rem;}
    .category-tag{font-size:.85rem;margin-bottom:.5rem;display:inline-block;}

    /* å°é½Šç›’ */
    .boxes-grid{display:grid;grid-auto-rows:auto;border:2px solid #94a3b8;border-radius:8px;overflow:hidden;}
    .box{display:flex;align-items:center;justify-content:center;min-height:60px;padding:.5rem;text-align:center;font-size:1.6rem;font-weight:700;border-right:2px solid #cbd5e1;}
    .box:last-child{border-right:none;}
    .grapheme-box{background:#f1f5f9;color:#1e293b;position:relative;font-family:'Inter','Noto Sans TC',sans-serif;border-bottom:2px solid #cbd5e1;grid-row:1;}
    .phoneme-box{
      background:#fff;
      color:#475569;
      font-family:'Noto Sans',sans-serif;
      font-size:1.35rem; /* Standard IPA size */
      font-weight:400; /* Standard font weight for both IPA and Phonics now */
      grid-row:2;
      transition: all 0.2s ease;
    }
    /* Phonics mode styling: still slightly larger and using system/Inter font, but font-weight is 400 */
    .phoneme-box.is-phonics {
      font-family:'Inter','Noto Sans TC',sans-serif;
      font-size:1.6rem; 
      color:#0f172a; 
      font-weight:400; /* Adjusted to 400 to match IPA */
    }
    .heart-symbol{position:absolute;bottom:-2px;left:0;right:0;text-align:center;color:#ef4444;font-size:1.1rem;line-height:1;}

    /* é å°¾ç‰ˆæ¬Šè³‡è¨Š (Credits) */
    .credits{
      margin-top: 2rem;       /* mt-8 */
      padding-top: 1.5rem;    /* pt-6 */
      border-top: 2px solid #e2e8f0; /* border-t border-slate-200 (using 2px for visibility) */
      text-align: center;     /* text-center */
      font-size: 0.875rem;    /* text-sm */
      color: #475569;         /* text-slate-600 */
      line-height: 1.6;       /* leading-snug or slightly more legible */
    }
    .credits a{
        color: #64748b; /* Icon color */
        margin: 0 0.5rem;
        transition: color 0.2s;
        text-decoration: none;
    }
    .credits a:hover{
        color: #3b82f6; /* Blue hover for interaction */
    }

    .word-tips{background:#fef3c7;border:1px solid #fbbf24;border-radius:6px;padding:.5rem .75rem;margin-top:1rem;font-family:'Noto Sans TC',sans-serif;color:#78350f;font-size:.95rem;line-height:1.4;display:flex;gap:.5rem;align-items:flex-start;}
    .tips-icon{color:#f59e0b;font-size:1.1rem;}

    /* New Toggle Switch Styles */
    .toggle-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.5rem; /* Reduced margin to pull up attribution text */
      font-weight: 700;
      color: #334155;
      user-select: none;
      font-size: 1rem;
    }

    /* Attribution Text Styles */
    .attribution-note {
      text-align: center;
      font-size: 0.85rem;
      color: #64748b; /* slate-500 */
      margin-top: 0; 
      margin-bottom: 1.5rem; /* Space before the legend */
      line-height: 1.5;
    }
    .attribution-note a {
      color: #3b82f6; /* blue-500 */
      text-decoration: underline;
    }
    .attribution-note a:hover {
      color: #1d4ed8; /* blue-700 */
    }

    .toggle-label-ipa {
        color: #64748b; /* Highlight IPA label */
        transition: color 0.2s;
    }
    .toggle-label-phonics {
        color: #64748b; /* Highlight Phonics label */
        transition: color 0.2s;
    }
    /* Highlight the active label */
    input:checked ~ .toggle-label-ipa {
        color: #64748b; /* IPA inactive color */
    }
    input:checked ~ .toggle-label-phonics {
        color: #0f172a; /* Phonics active color */
    }
    input:not(:checked) ~ .toggle-label-ipa {
        color: #0f172a; /* IPA active color */
    }
    input:not(:checked) ~ .toggle-label-phonics {
        color: #64748b; /* Phonics inactive color */
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
      /* Hide the actual label element so we can use the text outside the switch */
      visibility: hidden;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #cbd5e1; /* slate-300 */
      transition: .4s;
      border-radius: 34px;
      visibility: visible; /* Make slider visible */
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #3b82f6; /* blue-500 */
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }
    /* End Switch styling */

    @media (max-width:768px){
      .container{padding:.5rem;}
      h1{font-size:1.6rem;}
      #teaching-grid{grid-template-columns:1fr;}
      .word-text{font-size:2rem;}
      .box{font-size:1.4rem;min-height:50px;}
      .phoneme-box{font-size:1.2rem;}
      .phoneme-box.is-phonics {
        font-size:1.4rem; 
      }
      .attribution-note{
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <main>
      <section id="teachingPage" class="page-section active">
        <h1>æ•¸å­—è‹±æ–‡ 1â€“10 è²éŸ³å°ç…§è¡¨</h1>

        <!-- New Toggle Switch for IPA/Phonics -->
        <div class="toggle-container">
          <span class="toggle-label toggle-label-ipa">IPA éŸ³æ¨™</span>
          <label class="switch">
            <input type="checkbox" id="modeToggle">
            <span class="slider"></span>
          </label>
          <span class="toggle-label toggle-label-phonics">Phonics æ‹¼éŸ³</span>
        </div>
        
        <!-- NEW ATTRIBUTION LINE -->
        <p class="attribution-note">
          IPA æ ¹æ“š<a href="https://christinayu_english.rakosell.com/zh/page/american-ipa-guide" target="_blank">ç¾å¼è‹±èª IPA åœ‹éš›éŸ³æ¨™æŒ‡å—</a><br>
          Phonics æ ¹æ“š <a href="https://ufli.education.ufl.edu/wp-content/uploads/2023/09/UFLI-Sound-Wall-rev.pdf" target="_blank">UFLI phonemes</a>
        </p>
        
        <ul class="legend" id="category-filters" aria-label="åˆ†é¡ç¯©é¸">
          <li class="legend-item tag-all" data-category="all">å…¨éƒ¨</li>
          <li class="legend-item tag-irregular" data-category="irregular">ä¸è¦å‰‡æ‹¼å¯«</li>
          <li class="legend-item tag-closed" data-category="closed">é–‰éŸ³ç¯€-çŸ­æ¯éŸ³</li>
          <li class="legend-item tag-magic-e-cn" data-category="magic_e">é•·æ¯éŸ³ + éœéŸ³ 'e'</li>
          <li class="legend-item tag-vowel-team-cn" data-category="vowel_team">æ¯éŸ³çµ„åˆ</li>
          <li class="legend-item tag-diphthong" data-category="diphthong">é›™æ¯éŸ³</li>
          <li class="legend-item tag-open" data-category="open">é–‹éŸ³ç¯€-é•·æ¯éŸ³</li>
          <li class="legend-item tag-floss" data-category="floss">é‡è¤‡å­éŸ³å­—å°¾ (FLOSS-Z)</li>
          <li class="legend-item tag-digraph" data-category="digraph">é›™å­—æ¯å­éŸ³</li>
          <li class="legend-item tag-cluster" data-category="cluster">å­éŸ³ç¾¤</li>
          <li class="legend-item tag-suffix" data-category="suffix">å­—å°¾å¾Œç¶´</li>
          <li class="legend-item tag-rcontrolled" data-category="rcontrolled">æ¯éŸ³ + 'r'</li>

          <li class="legend-item tag-cle" data-category="cle">å­éŸ³ '-LE'</li>

          <li class="legend-item tag-silent-con" data-category="silent_consonant">ä¸ç™¼éŸ³å­éŸ³å­—æ¯</li>
        </ul>
        <div id="teaching-grid" role="region" aria-label="æ•™å­¸å¡ç‰‡æ¸…å–®"></div>
      </section>
    </main>
    <!-- æ–°å¢çš„ç‰ˆæ¬Šå’Œè¯çµ¡è³‡è¨Šå€å¡Š -->
    <footer class="credits">
        Â© 2025 Christina Yu. All rights reserved.<br /><br />
        
        <a href="mailto:mamahowma@gmail.com" aria-label="Email mamahowma"><i class="fa-solid fa-envelope fa-xl fa-fw"></i></a>ã€€
        <a href="https://www.facebook.com/mamahowma" target="_blank" aria-label="mamahowma Facebook Page"><i class="fa-brands fa-facebook fa-xl fa-fw"></i></a>ã€€
        <a href="https://portaly.cc/mamahowma/support" target="_blank" aria-label="Support mamahowma"><i class="fa-solid fa-mug-hot fa-xl fa-fw"></i></a>
    </footer>

  </div>

  <script>
    // =========================
    // è³‡æ–™ï¼ˆWORDSï¼‰ï¼šæ›´æ–°ç‚º UFLI Foundations ç¬¦è™Ÿ
    // =========================
    const WORDS = [
      // one - o: åƒçŸ­ uï¼Œä¸è¦å‰‡ã€‚n: /n/ã€‚e: éœéŸ³ã€‚
      { number:1, word:"one", ipa:"/wÊŒn/", graphemes:["o","n","e"], phonemes:["/wÊŒ/","/n/","-"], phonics:["/wÅ­/","/n/","-"], hearts:[true,false,true], hint:"o ç™¼ /wÊŒ/ (w + çŸ­æ¯éŸ³ u); e ä¸ç™¼éŸ³ã€‚" },
      // two - t: /t/ã€‚w: éœéŸ³ã€‚o: /oo/ã€‚
      { number:2, word:"two", ipa:"/tu/", graphemes:["t","w","o"], phonemes:["/t/","-","/u/"], phonics:["/t/","-","/Å«/"], hearts:[false,true,true], hint:"w ä¸ç™¼éŸ³ï¼›o ç™¼é•·æ¯éŸ³ u çš„è²éŸ³ /u/ã€‚" },
      // three - th: /th/ã€‚r: /r/ã€‚ee: /Ä“/ã€‚
      { number:3, word:"three", ipa:"/Î¸ri/", graphemes:["th","r","ee"], phonemes:["/Î¸/","/r/","/i/"], phonics:["/th/","/r/","/Ä“/"], hearts:[false,false,false], hint:"th æ˜¯é›™å­—æ¯å­éŸ³ï¼Œç™¼ç„¡è²åèˆŒéŸ³ /Î¸/ï¼›ee ç™¼é•·æ¯éŸ³ e /i/ã€‚" },
      // four - f: /f/ã€‚ou: /Ã´r/ (r-controlled)ã€‚r: éœéŸ³ï¼ˆåœ¨ r-controlled ä¹‹å¾Œï¼‰ã€‚
      { number:4, word:"four", ipa:"/fÉ”r/", graphemes:["f","ou","r"], phonemes:["/f/","/É”/","/r/"], phonics:["/f/","/aw/","/r/"], hearts:[false,true,false], hint:"ou ç™¼ /É”/ï¼ˆâ¤ï¼‰ã€‚" },
      // five - f: /f/ã€‚i: /Ä«/ã€‚v: /v/ã€‚e: éœéŸ³ã€‚
      { number:5, word:"five", ipa:"/faÉªv/", graphemes:["f","i","v","e"], phonemes:["/f/","/aÉª/","/v/","-"], phonics:["/f/","/Ä«/","/v/","-"], hearts:[false,false,false,false], hint:"éœéŸ³ eï¼šå­—å°¾ e ä¸ç™¼éŸ³ï¼Œi ç™¼é•·æ¯éŸ³ /aÉª/ã€‚" },
      // six - s: /s/ã€‚i: /Ä­/ã€‚x: /ks/ã€‚
      { number:6, word:"six", ipa:"/sÉªks/", graphemes:["s","i","x"], phonemes:["/s/","/Éª/","/ks/"], phonics:["/s/","/Ä­/","/ks/"], hearts:[false,false,false], hint:"æ¨™æº–é–‰éŸ³ç¯€-çŸ­æ¯éŸ³ï¼›x = /k/+ /s/ã€‚" },
      // seven - s: /s/ã€‚e: /Ä•/ã€‚v: /v/ã€‚e: /É™/ã€‚n: /n/ã€‚
      { number:7, word:"seven", ipa:"/ËˆsÉ›v.É™n/", graphemes:["s","e","v","e","n"], phonemes:["/s/","/É›/","/v/","/É™/","/n/"], phonics:["/s/","/Ä•/","/v/","/É™/","/n/"], hearts:[false,false,false,false,false], hint:"ç¬¬ä¸€å€‹ e ç™¼çŸ­æ¯éŸ³ e /É›/ï¼›ç¬¬äºŒéŸ³ç¯€ e ç™¼å¼±åŒ– /É™/ã€‚" },
      // eight - eigh: /Ä/ (ä¸è¦å‰‡)ã€‚t: /t/ã€‚
      { number:8, word:"eight", ipa:"/eÉªt/", graphemes:["eigh","t"], phonemes:["/eÉª/","/t/"], phonics:["/Ä/","/t/"], hearts:[true,false], hint:"eigh ç™¼ /eÉª/ï¼Œå¦‚é•·æ¯éŸ³ aï¼ˆâ¤ï¼‰ã€‚" },
      // nine - n: /n/ã€‚i: /Ä«/ã€‚n: /n/ã€‚e: éœéŸ³ã€‚
      { number:9, word:"nine", ipa:"/naÉªn/", graphemes:["n","i","n","e"], phonemes:["/n/","/aÉª/","/n/","-"], phonics:["/n/","/Ä«/","/n/","-"], hearts:[false,false,false,false], hint:"éœéŸ³ eï¼šå­—å°¾ e ä¸ç™¼éŸ³ï¼Œi ç™¼é•·æ¯éŸ³ /aÉª/ã€‚" },
      // ten - t: /t/ã€‚e: /Ä•/ã€‚n: /n/ã€‚
      { number:10, word:"ten", ipa:"/tÉ›n/", graphemes:["t","e","n"], phonemes:["/t/","/É›/","/n/"], phonics:["/t/","/Ä•/","/n/"], hearts:[false,false,false], hint:"æ¨™æº–é–‰éŸ³ç¯€-çŸ­æ¯éŸ³ã€‚" }
    ];

    // =========================
    // ä¸­æ–‡åˆ†é¡ï¼ˆé¡¯ç¤ºåç¨± & æ¨£å¼ï¼‰
    // =========================
    function tagInfo(key){
      switch(key){
        case 'irregular':        return { className:'tag-irregular',     name:'ä¸è¦å‰‡æ‹¼å¯«' };
        case 'closed':           return { className:'tag-closed',        name:'é–‰éŸ³ç¯€-çŸ­æ¯éŸ³' };
        case 'floss':            return { className:'tag-floss',         name:'é‡è¤‡å­éŸ³å­—å°¾ (FLOSS-Z)' };
        case 'digraph':          return { className:'tag-digraph',       name:'é›™å­—æ¯å­éŸ³' };
        case 'cluster':          return { className:'tag-cluster',       name:'å­éŸ³ç¾¤' };
        case 'suffix':           return { className:'tag-suffix',        name:'å­—å°¾å¾Œç¶´' };
        case 'rcontrolled':      return { className:'tag-rcontrolled',   name:"æ¯éŸ³ + 'r'" };
        case 'open':             return { className:'tag-open',          name:'é–‹éŸ³ç¯€-é•·æ¯éŸ³' };
        case 'cle':              return { className:'tag-cle',           name:"å­éŸ³ '-LE'" };
        case 'magic_e':          return { className:'tag-magic-e-cn',    name:"é•·æ¯éŸ³ + éœéŸ³ 'e'" };
        case 'vowel_team':       return { className:'tag-vowel-team-cn', name:'æ¯éŸ³çµ„åˆ' };
        case 'diphthong':        return { className:'tag-diphthong',     name:'é›™æ¯éŸ³' };
        case 'silent_consonant': return { className:'tag-silent-con',    name:'ä¸ç™¼éŸ³å­éŸ³å­—æ¯' };
        default:                 return { className:'tag-all',           name:'æœªåˆ†é¡' };
      }
    }

    // =========================
    // ä¾ä½ æŒ‡å®šçš„ã€Œå¤šé‡åˆ†é¡ã€æŒ‡æ´¾ï¼ˆåªä¿ç•™ 1-10ï¼‰
    // =========================
    const WORD_TAGS = {
      1:['irregular'],
      2:['irregular'],
      3:['cluster','vowel_team'],
      4:['irregular'],
      5:['magic_e'],
      6:['closed'],
      7:['closed'],
      8:['vowel_team'],
      9:['magic_e'],
      10:['closed']
    };

    // =========================
    // èªéŸ³æ’­æ”¾ï¼ˆWeb Speech APIï¼‰
    // =========================
    const synth = window.speechSynthesis; let voices = [];
    function getUSEnglishVoice(){
      if(voices.length===0 && synth.getVoices().length>0){ voices = synth.getVoices().filter(v=>v.lang.startsWith('en')); }
      return voices.find(v=>v.lang==='en-US') || voices[0] || null;
    }
    if(synth.onvoiceschanged!==undefined){ synth.onvoiceschanged = ()=>{ voices = synth.getVoices(); }; }
    function speak(word){
      if(synth.speaking) synth.cancel();
      if(!word) return;
      const u = new SpeechSynthesisUtterance(word);
      const v = getUSEnglishVoice();
      if(v) u.voice = v;
      u.lang='en-US'; u.rate=.9; u.pitch=1;
      synth.speak(u);
    }

    // =========================
    // æ¨¡å¼åˆ‡æ›ç‹€æ…‹
    // =========================
    let displayMode = 'ipa'; // 'ipa' or 'phonics'

    function toggleDisplayMode(){
      const toggle = document.getElementById('modeToggle');
      displayMode = toggle.checked ? 'phonics' : 'ipa';
      renderTeachingPage(); // Rerender to apply changes
      applyFilters(); // Re-apply filters to ensure visibility state is maintained
    }

    // =========================
    // æ•™å­¸å¡ç‰‡æ¸²æŸ“ï¼ˆå¾½ç« ç”¨ä¸­æ–‡å¤šé‡åˆ†é¡ï¼‰
    // =========================
    function renderTeachingPage(){
      const grid = document.getElementById('teaching-grid'); if(!grid) return;
      grid.innerHTML='';

      // æ ¹æ“šç•¶å‰æ¨¡å¼é¸æ“‡è³‡æ–™æ¬„ä½å’Œ CSS Class
      const phonemeKey = displayMode === 'phonics' ? 'phonics' : 'phonemes';
      const phonemeClass = displayMode === 'phonics' ? 'is-phonics' : '';

      WORDS.forEach(w=>{
        const tags = WORD_TAGS[w.number] || [];
        const badgeHTML = tags.map(t=>{
          const info = tagInfo(t);
          return `<span class="category-tag ${info.className}">${info.name}</span>`;
        }).join(' ');
        
        // å­—æ¯ (Graphemes)
        const gCells = w.graphemes.map((g,i)=>`<div class="grapheme-box box" role="gridcell">${g}${w.hearts[i]?'<span class="heart-symbol">â¤</span>':''}</div>`).join('');
        
        // éŸ³æ¨™/æ‹¼éŸ³ (Phonemes/Phonics)
        const pCells = w[phonemeKey].map(p=>`<div class="phoneme-box box ${phonemeClass}" role="gridcell">${p}</div>`).join('');

        const card = `
          <article class="word-card" data-number="${w.number}" data-tags="${tags.join(',')}" aria-label="å–®å­—å¡ ${w.word}">
            <header class="card-header">
              <div class="card-title"><span class="word-number">${w.number}</span><span class="word-text">${w.word}</span></div>
              <button class="audio-button" aria-label="æ’­æ”¾ ${w.word} è²éŸ³" onclick="speak('${w.word}')">ğŸ”Š</button>
            </header>
            <div class="card-body">
              ${badgeHTML}
              <div class="boxes-grid" role="grid" aria-label="å­—æ¯èˆ‡éŸ³æ¨™å°é½Šç›’"
                   style="grid-template-columns:repeat(${w.graphemes.length},1fr);grid-template-rows:repeat(2,auto);">
                ${gCells}
                ${pCells}
              </div>
              <div class="word-tips"><span class="tips-icon">ğŸ’¡</span><span>${w.hint}</span></div>
            </div>
          </article>`;
        grid.insertAdjacentHTML('beforeend', card);
      });
    }

    // =========================
    // ç¯©é¸ï¼ˆå–®é¸ + è‡ªå‹•éš±è—ç„¡å…§å®¹æŒ‰éˆ•ï¼‰
    // =========================
    let selectedFilter = 'all';

    function countByFilter(){
      // å›å‚³æ¯å€‹ filter key å°æ‡‰çš„å¡ç‰‡æ•¸é‡
      const counts = {};
      Object.keys(WORD_TAGS).forEach(num=>{
        (WORD_TAGS[num]||[]).forEach(tag=>{
          counts[tag] = (counts[tag]||0) + 1;
        });
      });
      return counts;
    }

    function setupCategoryFilters(){
      const buttons = Array.from(document.querySelectorAll('#category-filters .legend-item'));
      const counts = countByFilter();

      // è‡ªå‹•éš±è—æ²’æœ‰ä»»ä½•å–®å­—çš„æŒ‰éˆ•ï¼ˆä¿ç•™ã€Œå…¨éƒ¨ã€ï¼‰
      buttons.forEach(btn=>{
        const key = btn.dataset.category;
        if(key && key!=='all'){
          // Check if the key exists in the counts of the filtered 1-10 words
          if(!Object.prototype.hasOwnProperty.call(counts,key)){
            btn.style.display = 'none';
          }
        }
      });

      function updateButtons(){
        buttons.forEach(b=>{ b.classList.toggle('selected', (b.dataset.category||'all') === selectedFilter); });
      }

      buttons.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          selectedFilter = btn.dataset.category || 'all';
          updateButtons();
          applyFilters();
        });
      });

      updateButtons();
    }

    function applyFilters(){
      const cards = document.querySelectorAll('.word-card');
      if(selectedFilter === 'all'){
        cards.forEach(c=>c.classList.remove('hidden'));
        return;
      }
      cards.forEach(c=>{
        const tags = (c.getAttribute('data-tags')||'').split(',').filter(Boolean);
        c.classList.toggle('hidden', !tags.includes(selectedFilter));
      });
    }

    // =========================
    // INIT
    // =========================
    document.addEventListener('DOMContentLoaded',()=>{
      // Set up the toggle listener
      const toggle = document.getElementById('modeToggle');
      if(toggle){
        toggle.addEventListener('change', toggleDisplayMode);
      }
      
      renderTeachingPage();
      setupCategoryFilters();
    });
  </script>
</body>
</html>
